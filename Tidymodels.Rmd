---
title: "Tidymodels"
output: html_document
---

## Intro

I will use 'Credit', a small dataframe from ISLR data package, since the main goal is to explore the predict models only, not data wrangling.

Our goal is to predict the variable "Balance". I will use the mean squared error(MSE) as quality measure for our models.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Packages

```{r echo = T, results = 'hide'}

library(tidymodels)
library(ISLR)
library(tidyverse)
library(vip)
library(doParallel)
library(skimr)

```


## Gathering data

```{r}

df <- Credit %>% as_tibble()

```


## Exploring data

```{r}

skim(df)

```

Overall, this data frame is very clean and straightforward for modeling, but the column "ID" shall be removed, since it have no relevant predictive information.

#Removing ID

```{r}

df = subset(df, select = -c(ID))

```

#Rsample

Using Rsample package to set train/test data

```{r}

set.seed(150)

split <- initial_split(df, prop = 0.8) #80% train/20% test

training <- training(split) 
test <- testing(split) 


```

## Using recipe package for data processing


```{r}

recipe1 <- recipe(Balance ~ ., data = training) %>% 

  step_normalize(all_numeric(), -all_outcomes()) %>% # normalizing numeric variables except 'Balance'
  
  step_other(Ethnicity, threshold = .30, other = "Other") %>%  # creating 'Other' category for ethinicy
  
  step_dummy(all_nominal(), -all_outcomes()) # defining all string variables as dummies

summary(recipe1) # display variable roles

(recipe1_prep <- prep(recipe1)) # preparing the recipe

training_proc <- bake(recipe1_prep, new_data = NULL) # processed training dataframe

test_proc <- bake(recipe1_prep, new_data = test) # processed test dataframe


```

## Going for the models using parsnip

Now that we have our training and test dataframe, we will create linear and random forest models

```{r}

lm <- linear_reg() %>% set_engine("lm") # defining linear regression as engine


lm_fit <- linear_reg() %>% set_engine("lm") %>%  fit(Balance ~ ., training_proc)

tidy(lm_fit)


fitted_lm <- lm_fit %>% 
  predict(new_data = teste_proc) %>% # realiza predicao para os dados de teste
  mutate(observado = teste_proc$Balance, # cria uma coluna com o valor observado de Balance
         modelo = "lm")

```





## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
